# 點數系統開發記錄 - 2025/06/18

## 📋 **開發目標**
在會員附加宣傳卡片時：
1. 檢查會員及附加宣傳卡片的點數，若會員卡之點數小於0則無附加卡片
2. 若附加卡片之點數小於0則無法附加
3. 依據會員卡附加的位置給予點數回饋，越左邊回饋比例越高
4. 回饋比例由系統後台統一設定(頁面)由ADMIN來設定

## ⚠️ **重要提醒**
- 今日嘗試開發點數系統時破壞了核心分享功能
- 已回復到 `20250608-FINAL` 穩定版本
- 所有點數系統相關檔案已移除，避免影響現有功能

## 🗂️ **原計劃檔案清單**
1. `supabase/add-points-system.sql` - 資料庫擴展腳本
2. `pages/api/cards/points.js` - 點數計算API
3. `pages/api/points-settings.js` - 設定管理API
4. `public/admin-points.html` - ADMIN設定頁面
5. 前端整合修改 - HTML點數顯示區、JavaScript點數函數

## 🔧 **核心設計概念**
- 複製 `pageview` 系統的成功模式
- 簡化設計：直接在會員卡儲存點數，不需要複雜的交易表
- 位置回饋：位置0(最左邊)回饋最高，依序遞減

## 📊 **資料庫設計**
```sql
-- 會員卡加入點數欄位
ALTER TABLE member_cards ADD COLUMN user_points decimal(10,2) DEFAULT 100.0;

-- 點數設定表
CREATE TABLE points_settings (
  position_index int PRIMARY KEY,
  reward_percentage decimal(5,2) NOT NULL DEFAULT 10.0
);

-- 預設回饋比例：位置0=15%, 位置1=12%, 位置2=10%, 位置3=8%, 位置4=5%
```

## 💡 **明日開發建議**
1. **先確保分享功能正常**：在穩定版本上測試分享功能
2. **小步快跑**：一次只加入一個小功能，立即測試
3. **避免修改核心邏輯**：不要動到現有的分享、預覽等核心功能
4. **詳細測試**：每個修改都要在LINE App中測試分享功能

## 🚫 **今日學到的教訓**
- 不要同時修改多個核心功能
- 每次修改後都要測試分享功能
- 保持小幅度漸進式開發
- 及時建立穩定版本的備份點

## 📅 **建議開發順序**
1. 先建立資料庫結構（不影響現有功能）
2. 建立獨立的點數API（不整合到前端）
3. 建立ADMIN設定頁面（獨立頁面）
4. 最後才整合到會員卡頁面（小心謹慎）

---
**版本狀態**: 已回復到 `20250608-FINAL` (e0f1258) - 分享功能正常
**下次開發**: 請參考此記錄，避免重複今日的問題 