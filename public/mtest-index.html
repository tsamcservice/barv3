<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ å¿«é€Ÿç·¨è¼¯å™¨ç³»çµ± - MTEST</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/flex2html.css">
    <script src="js/flex2html.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5rem;
            color: #333;
            margin: 0;
        }
        
        .system-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        .quick-editor-system {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }
        .main-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .btn-primary {
            background: rgba(255,255,255,0.95);
            color: #667eea;
            padding: 12px 24px;
            border-radius: 12px;
            text-decoration: none;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            transform: scale(1.05);
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            text-decoration: none;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        .share-platforms {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 12px;
            margin-top: 1rem;
        }
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
            margin-top: 1rem;
        }
        .platform-btn {
            padding: 8px 12px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            transition: all 0.2s ease;
        }
        .platform-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .preview-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .feature-explanation {
            background: #e8f4ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
        .admin-section {
            background: #fff5f5;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #dc3545;
        }
        .admin-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        .admin-btn {
            background: #dc3545;
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        .admin-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
                 @media (max-width: 768px) {
             .main-buttons {
                 flex-direction: column;
                 align-items: center;
             }
             .btn-primary, .btn-secondary {
                 width: 100%;
                 max-width: 300px;
             }
         }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1>ğŸš€ å¿«é€Ÿç·¨è¼¯å™¨ç³»çµ±</h1>
            <p style="color: #666; font-size: 18px; margin: 10px 0;">MTEST å°ˆç”¨ç‰ˆæœ¬ - å¤šå¹³å°åˆ†äº«æ¶æ§‹</p>
        </div>

        <!-- ğŸš€ å…¨æ–°å¿«é€Ÿç·¨è¼¯å™¨ç³»çµ± -->
        <div class="quick-editor-system">
            <h2 style="margin: 0 0 1rem 0; font-size: 1.5rem; font-weight: bold; text-align: center;">
                ğŸš€ å…¨æ–°å¿«é€Ÿç·¨è¼¯å™¨ç³»çµ±
            </h2>
            <p style="text-align: center; margin: 0 0 1.5rem 0; font-size: 14px; opacity: 0.9;">
                âš¡ 0.5ç§’è¼‰å…¥ | ğŸ¨ é›¢ç·šç·¨è¼¯ | ğŸ“± å¤šå¹³å°åˆ†äº« | ğŸ” å®‰å…¨æˆæ¬Š
            </p>
            
                         <!-- ç™»å…¥ç‹€æ…‹æç¤º -->
             <div id="loginStatus" class="feature-explanation" style="background: rgba(255,255,255,0.1); color: white; margin-bottom: 1.5rem;">
                 <h3 style="margin: 0 0 10px 0; font-size: 16px;">ğŸ“‹ ç³»çµ±ç‹€æ…‹</h3>
                 <div id="statusContent" style="font-size: 14px; line-height: 1.6;">
                     <p style="margin: 5px 0;">ğŸ” æ­£åœ¨æª¢æŸ¥ç™»å…¥ç‹€æ…‹...</p>
                 </div>
             </div>
            
                         <!-- ä¸»è¦å…¥å£æŒ‰éˆ• -->
             <div class="main-buttons">
                 <a href="#" onclick="smartEdit(); return false;" id="editBtn" class="btn-primary">
                     âš¡ æ™ºèƒ½ç·¨è¼¯
                 </a>
                 <a href="#" onclick="forceLogin(); return false;" class="btn-secondary">
                     ğŸ‘¤ é‡æ–°ç™»å…¥
                 </a>
             </div>
            
            <!-- ğŸ”§ ç§»é™¤åˆ†äº«å¹³å°æŒ‰éˆ•ç¾¤ - æ ¹æ“šéœ€æ±‚2-2ï¼ŒMTEST-INDEXåªæœ‰é è¦½å’Œèªªæ˜ï¼Œä¸è¦åˆ†äº«æŒ‰éˆ• -->
            <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; margin-top: 1rem;">
                <h4 style="margin: 0 0 1rem 0; font-size: 14px; text-align: center; opacity: 0.9;">
                    ğŸ“‹ åŠŸèƒ½èªªæ˜
                </h4>
                <div style="text-align: center; color: rgba(255,255,255,0.9); font-size: 13px; line-height: 1.6;">
                    <p style="margin: 8px 0;">âœ… å‹•æ…‹è¼‰å…¥è³‡æ–™åº«è³‡æ–™</p>
                    <p style="margin: 8px 0;">ğŸ‘¤ è‡ªå‹•æ‡‰ç”¨LINEå€‹äººè³‡æ–™</p>
                    <p style="margin: 8px 0;">ğŸ¨ å€‹äººåŒ–å¡ç‰‡é è¦½</p>
                    <p style="margin: 8px 0;">ğŸ“± åˆ†äº«åŠŸèƒ½è«‹ä½¿ç”¨æ™ºèƒ½ç·¨è¼¯å™¨</p>
                </div>
            </div>
        </div>

        <!-- å³æ™‚é è¦½å€ - å–®ä¸€å€å¡Š -->
        <div class="preview-container">
            <h2 style="margin: 0 0 20px 0; color: #333; text-align: center;">ğŸ‘€ å³æ™‚é è¦½ - M01001æœƒå“¡å¡</h2>
            <div id="flex2html" style="max-width: 400px; margin: 0 auto;">
                <!-- è¼‰å…¥ä¸­é¡¯ç¤º -->
                <div id="loading-indicator" style="text-align: center; padding: 40px; color: #666;">
                    <div style="font-size: 24px; margin-bottom: 10px;">ğŸ”„</div>
                    <div>æ­£åœ¨è¼‰å…¥å¡ç‰‡è³‡æ–™...</div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 15px; font-size: 14px; color: #666;">
                <p id="preview-description">ğŸ“‹ æ­£åœ¨å¾è³‡æ–™åº«è¼‰å…¥ M01001 æœƒå“¡å¡è³‡æ–™</p>
                <p>ğŸ¨ é»æ“Šã€Œæ™ºèƒ½ç·¨è¼¯ã€æˆ–ã€Œé‡æ–°ç™»å…¥ã€é–‹å§‹å€‹äººåŒ–ç·¨è¼¯</p>
            </div>
        </div>
    </div>

    <script src="js/editor.js"></script>
    <script>
        // ğŸ”§ ä¿®æ­£ï¼šç§»é™¤ç¡¬ç·¨ç¢¼ï¼Œæ”¹ç‚ºå‹•æ…‹è¼‰å…¥
        let m01001CardData = null;
        let isDataLoaded = false;
        
        // ğŸš€ å¾è³‡æ–™åº«è¼‰å…¥M01001å¡ç‰‡è³‡æ–™
        async function loadM01001CardData() {
            try {
                console.log('ğŸ”„ é–‹å§‹è¼‰å…¥M01001å¡ç‰‡è³‡æ–™...');
                
                // æª¢æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„LINEå€‹äººè³‡æ–™
                const lineProfile = getValidLineProfile();
                
                let apiUrl = '/api/cards?pageId=M01001';
                
                // å¦‚æœæœ‰LINEå€‹äººè³‡æ–™ï¼Œå„ªå…ˆè¼‰å…¥å€‹äººåŒ–è³‡æ–™
                if (lineProfile && lineProfile.userId) {
                    console.log('ğŸ‘¤ ç™¼ç¾LINEå€‹äººè³‡æ–™ï¼Œå˜—è©¦è¼‰å…¥å€‹äººåŒ–å¡ç‰‡');
                    apiUrl += `&userId=${lineProfile.userId}`;
                }
                
                const response = await fetch(apiUrl);
                const result = await response.json();
                
                if (result.success && result.data && result.data.length > 0) {
                    const cardData = result.data[0];
                    console.log('âœ… æˆåŠŸè¼‰å…¥å¡ç‰‡è³‡æ–™:', cardData);
                    
                    // å¦‚æœæœ‰LINEå€‹äººè³‡æ–™ï¼Œä¸”å¡ç‰‡è³‡æ–™ä¸­æ²’æœ‰å€‹äººåŒ–è³‡æ–™ï¼Œé€²è¡Œå€‹äººåŒ–è™•ç†
                    if (lineProfile && lineProfile.userId && !cardData.line_user_id) {
                        console.log('ğŸ¨ æ‡‰ç”¨LINEå€‹äººè³‡æ–™åˆ°é è¨­å¡ç‰‡');
                        return personalizeCardData(cardData, lineProfile);
                    }
                    
                    // è½‰æ›è³‡æ–™åº«æ ¼å¼ç‚ºflex_jsonæ ¼å¼
                    return convertToFlexJson(cardData);
                } else {
                    console.error('âŒ ç„¡æ³•è¼‰å…¥å¡ç‰‡è³‡æ–™:', result);
                    return null;
                }
                
            } catch (error) {
                console.error('âŒ è¼‰å…¥å¡ç‰‡è³‡æ–™å¤±æ•—:', error);
                return null;
            }
        }
        
        // ğŸ¨ å€‹äººåŒ–å¡ç‰‡è³‡æ–™
        function personalizeCardData(cardData, lineProfile) {
            console.log('ğŸ¨ å€‹äººåŒ–å¡ç‰‡è³‡æ–™:', lineProfile);
            
            // å‰µå»ºå€‹äººåŒ–çš„å¡ç‰‡è³‡æ–™
            const personalizedCard = {
                ...cardData,
                display_name: lineProfile.displayName || cardData.display_name,
                member_image_url: lineProfile.pictureUrl || cardData.member_image_url,
                line_user_id: lineProfile.userId
            };
            
            // æ›´æ–°é è¦½èªªæ˜
            const descriptionEl = document.getElementById('preview-description');
            if (descriptionEl) {
                descriptionEl.innerHTML = `ğŸ‘¤ å·²è¼‰å…¥æ‚¨çš„å€‹äººåŒ–å¡ç‰‡ - æ­¡è¿ ${lineProfile.displayName}ï¼`;
            }
            
            return convertToFlexJson(personalizedCard);
        }
        
        // ğŸ”„ è½‰æ›è³‡æ–™åº«æ ¼å¼ç‚ºflex_jsonæ ¼å¼
        function convertToFlexJson(cardData) {
            try {
                // å¦‚æœå·²ç¶“æœ‰flex_jsonï¼Œç›´æ¥ä½¿ç”¨
                if (cardData.flex_json) {
                    return cardData.flex_json;
                }
                
                // å¦‚æœæ²’æœ‰flex_jsonï¼Œä½¿ç”¨getMainBubbleå‡½æ•¸ç”Ÿæˆ
                if (typeof getMainBubble === 'function') {
                    const bubbleData = getMainBubble({ ...cardData, page_id: 'M01001' });
                    return {
                        type: 'flex',
                        altText: cardData.card_alt_title || cardData.main_title_1 || 'æˆ‘åœ¨å‘ˆç’½/å‘ˆç’½',
                        contents: bubbleData
                    };
                }
                
                // ä½¿ç”¨é è¨­çš„å¡ç‰‡çµæ§‹
                return getDefaultFlexJson(cardData);
                
            } catch (error) {
                console.error('âŒ è½‰æ›flex_jsonå¤±æ•—:', error);
                return getDefaultFlexJson(cardData);
            }
        }
        
        // ğŸ”§ å–å¾—æœ‰æ•ˆçš„LINEå€‹äººè³‡æ–™
        function getValidLineProfile() {
            try {
                const storedProfile = localStorage.getItem('lineUserProfile');
                const authCompleted = localStorage.getItem('lineAuthCompleted');
                
                if (storedProfile && authCompleted) {
                    const profile = JSON.parse(storedProfile);
                    
                    // æª¢æŸ¥è³‡æ–™å®Œæ•´æ€§å’Œæ™‚æ•ˆæ€§ï¼ˆ24å°æ™‚å…§ï¼‰
                    if (profile.userId && profile.displayName && profile.timestamp) {
                        const hoursPassed = (Date.now() - profile.timestamp) / (1000 * 60 * 60);
                        
                        if (hoursPassed < 24) {
                            return profile;
                        }
                    }
                }
                
                return null;
            } catch (error) {
                console.error('âŒ è§£æLINEå€‹äººè³‡æ–™å¤±æ•—:', error);
                return null;
            }
        }
        
        // ğŸ”§ é è¨­çš„flex_jsonçµæ§‹
        function getDefaultFlexJson(cardData) {
            return {
                "type": "flex",
                "altText": cardData.card_alt_title || cardData.main_title_1 || "æˆ‘åœ¨å‘ˆç’½/å‘ˆç’½",
                "contents": {
                    "type": "bubble",
                    "size": "mega",
                    "body": {
                        "type": "box",
                        "layout": "vertical",
                        "contents": [
                            {
                                "type": "image",
                                "size": "full",
                                "aspectRatio": "1:1",
                                "aspectMode": "cover",
                                "url": cardData.main_image_url || "https://barv3.vercel.app/uploads/vip/TS-B1.png"
                            },
                            {
                                "type": "image",
                                "url": cardData.snow_image_url || "https://barv3.vercel.app/uploads/vip/APNG1.png",
                                "size": "full",
                                "aspectRatio": "1:1",
                                "animated": true,
                                "aspectMode": "cover",
                                "position": "absolute",
                                "action": {
                                    "type": "uri",
                                    "label": "action",
                                    "uri": cardData.main_image_link || "https://secure.smore.com/n/td1qc"
                                }
                            },
                            {
                                "size": "20px",
                                "text": cardData.display_name || "æˆ‘åœ¨å‘ˆç’½",
                                "type": "text",
                                "align": "center",
                                "color": cardData.name_color1 || "#000000",
                                "weight": "bold",
                                "margin": "md"
                            },
                            {
                                "type": "box",
                                "layout": "vertical",
                                "contents": [
                                    {
                                        "type": "text",
                                        "text": cardData.main_title_2 || "æˆ‘åœ¨å‘ˆç’½ï¼Œæ¬£è³ç¾å¥½å¹¸ç¦ï¼",
                                        "wrap": true,
                                        "size": "16px",
                                        "margin": "sm",
                                        "color": cardData.main_title_2_color || "#000000"
                                    }
                                ],
                                "paddingEnd": "65px",
                                "paddingStart": "5px",
                                "height": "95px"
                            },
                            {
                                "type": "box",
                                "layout": "horizontal",
                                "contents": [
                                    {
                                        "type": "button",
                                        "action": {
                                            "type": "uri",
                                            "label": cardData.button_1_text || "åŠ å‘ˆç’½å¥½å‹",
                                            "uri": cardData.button_1_url || "https://lin.ee/JLLIBlP"
                                        },
                                        "color": cardData.button_1_color || "#a4924a",
                                        "style": "primary",
                                        "height": "sm"
                                    },
                                    {
                                        "type": "button",
                                        "action": {
                                            "type": "uri",
                                            "label": cardData.s_button_text || "åˆ†äº«çµ¦å¥½å‹",
                                            "uri": cardData.s_button_url || "https://liff.line.me/2007327814-OoJBbnwP?pageId=M01001"
                                        },
                                        "color": cardData.s_button_color || "#a4924b",
                                        "style": "primary",
                                        "height": "sm"
                                    }
                                ],
                                "margin": "md"
                            }
                        ],
                        "backgroundColor": "#E1E6E0",
                        "paddingAll": "10px"
                    }
                }
            };
        }
        
        // ğŸ”„ æ¸²æŸ“å¡ç‰‡é è¦½
        async function renderCardPreview() {
            const loadingIndicator = document.getElementById('loading-indicator');
            const flex2htmlDiv = document.getElementById('flex2html');
            
            try {
                // è¼‰å…¥å¡ç‰‡è³‡æ–™
                m01001CardData = await loadM01001CardData();
                
                if (m01001CardData) {
                    // éš±è—è¼‰å…¥æŒ‡ç¤ºå™¨
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }
                    
                    // æ¸²æŸ“å¡ç‰‡
                    if (typeof flex2html === 'function') {
                        flex2html('flex2html', m01001CardData);
                        console.log('âœ… å¡ç‰‡é è¦½æ¸²æŸ“å®Œæˆ');
                    } else {
                        console.error('âŒ flex2htmlå‡½æ•¸æœªè¼‰å…¥');
                        showError('æ¸²æŸ“å‡½æ•¸æœªè¼‰å…¥');
                    }
                    
                    isDataLoaded = true;
                } else {
                    showError('è¼‰å…¥å¡ç‰‡è³‡æ–™å¤±æ•—');
                }
            } catch (error) {
                console.error('âŒ æ¸²æŸ“å¡ç‰‡é è¦½å¤±æ•—:', error);
                showError('æ¸²æŸ“å¡ç‰‡é è¦½å¤±æ•—');
            }
        }
        
        // ğŸ”§ é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        function showError(message) {
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator) {
                loadingIndicator.innerHTML = `
                    <div style="color: #c62828; font-size: 16px;">âŒ ${message}</div>
                    <button onclick="renderCardPreview()" style="
                        margin-top: 10px;
                        padding: 8px 16px;
                        background: #4caf50;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                    ">ğŸ”„ é‡æ–°è¼‰å…¥</button>
                `;
            }
        }

        // é é¢è¼‰å…¥æ™‚æ¸²æŸ“å¡ç‰‡ä¸¦æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        window.onload = function() {
            // ğŸ”§ ä¿®æ­£ï¼šæ”¹ç‚ºå‹•æ…‹è¼‰å…¥
            renderCardPreview();
            checkLoginStatus();
            
            // ç›£è½localStorageè®ŠåŒ–ï¼ˆç•¶ç”¨æˆ¶å¾å…¶ä»–åˆ†é ç™»å…¥æ™‚ï¼‰
            window.addEventListener('storage', function(e) {
                if (e.key === 'lineUserProfile' || e.key === 'lineAuthCompleted') {
                    checkLoginStatus();
                    // é‡æ–°æ¸²æŸ“å¡ç‰‡ä»¥æ‡‰ç”¨å€‹äººåŒ–è³‡æ–™
                    if (isDataLoaded) {
                        renderCardPreview();
                    }
                }
            });
            
            // æª¢æŸ¥URLåƒæ•¸ï¼ˆå¾LINEæˆæ¬Šå›ä¾†ï¼‰
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('authSuccess')) {
                setTimeout(() => {
                    checkLoginStatus();
                    // é‡æ–°æ¸²æŸ“å¡ç‰‡ä»¥æ‡‰ç”¨å€‹äººåŒ–è³‡æ–™
                    renderCardPreview();
                }, 500);
            }
        };
        
        // æ™ºèƒ½ç·¨è¼¯ç³»çµ± - åŠ å¼·ç™»å…¥ç‹€æ…‹æª¢æŸ¥
        function checkLoginStatus() {
            const lineProfile = localStorage.getItem('lineUserProfile');
            const authCompleted = localStorage.getItem('lineAuthCompleted');
            const statusContent = document.getElementById('statusContent');
            const editBtn = document.getElementById('editBtn');
            
            // æ›´åš´æ ¼çš„ç™»å…¥ç‹€æ…‹æª¢æŸ¥
            let isValidLogin = false;
            let userData = null;
            
            if (lineProfile && authCompleted) {
                try {
                    userData = JSON.parse(lineProfile);
                    // æª¢æŸ¥å¿…è¦æ¬„ä½å’Œæ™‚æ•ˆæ€§ï¼ˆ24å°æ™‚å…§ï¼‰
                    if (userData.userId && userData.displayName && userData.timestamp) {
                        const now = Date.now();
                        const loginTime = userData.timestamp;
                        const hoursPassed = (now - loginTime) / (1000 * 60 * 60);
                        
                        if (hoursPassed < 24) {
                            isValidLogin = true;
                        }
                    }
                } catch (e) {
                    console.error('Invalid lineProfile data:', e);
                    // æ¸…ç†æå£çš„è³‡æ–™
                    localStorage.removeItem('lineUserProfile');
                    localStorage.removeItem('lineAuthCompleted');
                }
            }
            
            if (isValidLogin && userData) {
                // å·²ç™»å…¥ç‹€æ…‹
                statusContent.innerHTML = `
                    <p style="margin: 5px 0;">âœ… <strong>å·²ç™»å…¥</strong> - æ­¡è¿ï¼Œ${userData.displayName}ï¼</p>
                    <p style="margin: 5px 0;">ğŸ¯ é»æ“Šã€Œæ™ºèƒ½ç·¨è¼¯ã€ç›´æ¥é€²å…¥ç·¨è¼¯å™¨</p>
                    <p style="margin: 5px 0;">ğŸ”„ å¦‚éœ€æ›´æ–°å€‹è³‡ï¼Œè«‹é»æ“Šã€Œé‡æ–°ç™»å…¥ã€</p>
                    <p style="margin: 3px 0; font-size: 12px; opacity: 0.8;">ğŸ‘¤ LINE ID: ${userData.userId.substring(0, 8)}...</p>
                `;
                editBtn.innerHTML = 'âš¡ æ™ºèƒ½ç·¨è¼¯';
                editBtn.style.background = 'rgba(0,255,0,0.9)';
                editBtn.style.color = 'white';
            } else {
                // æœªç™»å…¥æˆ–ç™»å…¥å·²éæœŸ
                statusContent.innerHTML = `
                    <p style="margin: 5px 0;">âŒ <strong>æœªç™»å…¥</strong> - å°šæœªç²å–LINEå€‹äººè³‡æ–™</p>
                    <p style="margin: 5px 0;">ğŸ¯ é»æ“Šã€Œæ™ºèƒ½ç·¨è¼¯ã€å°‡å¼•å°æ‚¨ç™»å…¥</p>
                    <p style="margin: 5px 0;">ğŸ’¡ ç™»å…¥å¾Œå¯äº«å—å€‹äººåŒ–ç·¨è¼¯é«”é©—</p>
                    <p style="margin: 3px 0; font-size: 12px; opacity: 0.8;">ğŸ”§ <a href="#" onclick="clearLoginData(); checkLoginStatus(); return false;" style="color: #ffd700;">æ¸…é™¤ç™»å…¥å¿«å–</a></p>
                `;
                editBtn.innerHTML = 'âš¡ æ™ºèƒ½ç·¨è¼¯';
                editBtn.style.background = 'rgba(255,193,7,0.9)';
                editBtn.style.color = '#000';
            }
        }
        
        // æ¸…é™¤ç™»å…¥è³‡æ–™çš„å‡½æ•¸
        function clearLoginData() {
            localStorage.removeItem('lineUserProfile');
            localStorage.removeItem('lineAuthCompleted');
            alert('ğŸ§¹ ç™»å…¥å¿«å–å·²æ¸…é™¤ï¼');
        }
        
        function smartEdit() {
            console.log('ğŸš€ ç°¡åŒ–æ™ºèƒ½ç·¨è¼¯ç³»çµ± - ç›´æ¥è·³è½‰åˆ°MTEST');
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const editBtn = document.getElementById('editBtn');
            if (editBtn) {
                editBtn.innerHTML = 'ğŸ”„ è¼‰å…¥ä¸­...';
                editBtn.style.background = 'rgba(108,117,125,0.8)';
                editBtn.disabled = true;
            }
            
            // ç›´æ¥è·³è½‰åˆ° mcard-mtest.htmlï¼Œè®“å®ƒè‡ªå·±è™•ç†æ‰€æœ‰èªè­‰é‚è¼¯
            // ä¸å†éœ€è¦è¤‡é›œçš„èªè­‰æª¢æŸ¥å’Œå¤šé‡è·³è½‰
            setTimeout(() => {
                window.location.href = '/mcard-mtest.html?source=mtest-index';
            }, 300);
        }
        
        function forceLogin() {
            console.log('ğŸ”„ ç°¡åŒ–é‡æ–°ç™»å…¥æµç¨‹');
            
            // æ¸…é™¤èˆŠçš„èªè­‰è³‡æ–™
            localStorage.removeItem('lineUserProfile');
            localStorage.removeItem('lineAuthCompleted');
            localStorage.removeItem('authTimestamp');
            
            // æ›´æ–°ç™»å…¥ç‹€æ…‹é¡¯ç¤º
            checkLoginStatus();
            
            // ç›´æ¥è·³è½‰åˆ°MTESTï¼Œè®“å®ƒè™•ç†é‡æ–°ç™»å…¥
            setTimeout(() => {
                window.location.href = '/mcard-mtest.html?source=mtest-index&forceLogin=true';
            }, 500);
        }


    </script>
</body>
</html> 