<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ å¡ç‰‡é è¦½ - å‘ˆç’½å…ƒå®‡å®™</title>
    
    <!-- å‹•æ…‹OG Meta Tags -->
    <meta property="og:title" content="ğŸ¯ å°ˆå±¬æœƒå“¡å¡ - å‘ˆç’½å…ƒå®‡å®™" id="og-title">
    <meta property="og:description" content="æ­¡è¿ä¾†åˆ°å‘ˆç’½å…ƒå®‡å®™3Då±•è¦½é¤¨ï¼Œé«”é©—ç¨ç‰¹çš„æœƒå“¡å¡åˆ†äº«ï¼" id="og-description">
    <meta property="og:image" content="https://barv3.vercel.app/uploads/vip/TS-LOGO.png" id="og-image">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://barv3.vercel.app/og-card.html" id="og-url">
    <meta property="og:site_name" content="å‘ˆç’½å…ƒå®‡å®™">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ğŸ¯ å°ˆå±¬æœƒå“¡å¡ - å‘ˆç’½å…ƒå®‡å®™" id="twitter-title">
    <meta name="twitter:description" content="æ­¡è¿ä¾†åˆ°å‘ˆç’½å…ƒå®‡å®™3Då±•è¦½é¤¨ï¼Œé«”é©—ç¨ç‰¹çš„æœƒå“¡å¡åˆ†äº«ï¼" id="twitter-description">
    <meta name="twitter:image" content="https://barv3.vercel.app/uploads/vip/TS-LOGO.png" id="twitter-image">
    
    <!-- å…¶ä»–Meta Tags -->
    <meta name="description" content="å‘ˆç’½å…ƒå®‡å®™3Då±•è¦½é¤¨ - å°ˆå±¬æœƒå“¡å¡åˆ†äº«å¹³å°">
    <meta name="keywords" content="å‘ˆç’½,å…ƒå®‡å®™,3Då±•è¦½,æœƒå“¡å¡,åˆ†äº«">
    <meta name="author" content="å‘ˆç’½å…ƒå®‡å®™">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 400px;
            width: 100%;
            position: relative;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .card-preview {
            padding: 30px 20px;
            text-align: center;
        }
        
        .card-image {
            width: 200px;
            height: 200px;
            border-radius: 15px;
            object-fit: cover;
            margin: 0 auto 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid #4CAF50;
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .card-description {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        
        .member-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .member-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .member-id {
            font-size: 12px;
            color: #666;
        }
        
        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .share-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .share-btn.line {
            background: #00C300;
            color: white;
        }
        
        .share-btn.email {
            background: #EA4335;
            color: white;
        }
        
        .share-btn.facebook {
            background: #1877F2;
            color: white;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            display: none;
            text-align: center;
            padding: 40px 20px;
            color: #f44336;
        }
        
        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        
        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
            display: none;
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .card-preview {
                padding: 20px 15px;
            }
            
            .card-image {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ å°ˆå±¬æœƒå“¡å¡</h1>
            <p>å‘ˆç’½å…ƒå®‡å®™3Då±•è¦½é¤¨</p>
        </div>
        
        <div class="card-preview" id="card-preview">
            <img src="https://barv3.vercel.app/uploads/vip/TS-LOGO.png" alt="æœƒå“¡å¡é è¦½" class="card-image" id="card-image">
            <div class="card-title" id="card-title">æ­¡è¿ä¾†åˆ°å‘ˆç’½å…ƒå®‡å®™</div>
            <div class="card-description" id="card-description">é«”é©—ç¨ç‰¹çš„3Då±•è¦½é¤¨æœƒå“¡å¡åˆ†äº«åŠŸèƒ½</div>
            
            <div class="member-info">
                <div class="member-name" id="member-name">å‘ˆç’½æœƒå“¡</div>
                <div class="member-id" id="member-id">æœƒå“¡ç·¨è™Ÿ: å‘ˆç’½</div>
            </div>
            
            <div class="share-buttons">
                <button class="share-btn line" onclick="shareToLine()">
                    ğŸ“± åˆ†äº«åˆ°LINE
                </button>
                <button class="share-btn email" onclick="shareToEmail()">
                    ğŸ“§ åˆ†äº«åˆ°EMAIL
                </button>
                <button class="share-btn facebook" onclick="shareToFacebook()">
                    ğŸ“˜ åˆ†äº«åˆ°Facebook
                </button>
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>è¼‰å…¥å¡ç‰‡è³‡æ–™ä¸­...</p>
        </div>
        
        <div class="error" id="error">
            <p>âŒ è¼‰å…¥å¤±æ•—</p>
            <p id="error-message">ç„¡æ³•è¼‰å…¥å¡ç‰‡è³‡æ–™</p>
        </div>
        
        <div class="footer">
            <p>Â© 2025 å‘ˆç’½å…ƒå®‡å®™. ä¿ç•™æ‰€æœ‰æ¬Šåˆ©.</p>
        </div>
    </div>
    
    <div class="debug-info" id="debug-info">
        <strong>Debug è³‡è¨Š:</strong><br>
        <span id="debug-content"></span>
    </div>
    
    <script>
        // ğŸ”§ ä¿®å¾©æ’åºå•é¡Œï¼šOGé è¦½é é¢æ ¸å¿ƒé‚è¼¯
        class OGPreviewManager {
            constructor() {
                this.cardData = null;
                this.debugMode = false;
                this.init();
            }
            
            init() {
                console.log('ğŸ¯ OGé è¦½é é¢åˆå§‹åŒ–');
                this.parseURLParams();
                this.setupDebugMode();
                this.loadCardData();
            }
            
            parseURLParams() {
                const urlParams = new URLSearchParams(window.location.search);
                this.shareData = urlParams.get('shareData');
                this.cardId = urlParams.get('cardId');
                this.userId = urlParams.get('userId');
                this.pageId = urlParams.get('pageId') || 'M01001';
                
                console.log('ğŸ“‹ URLåƒæ•¸è§£æ:', {
                    shareData: !!this.shareData,
                    cardId: this.cardId,
                    userId: this.userId,
                    pageId: this.pageId
                });
            }
            
            setupDebugMode() {
                // é–‹ç™¼æ¨¡å¼ï¼šæŒ‰F12é¡¯ç¤ºèª¿è©¦è³‡è¨Š
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'F12') {
                        this.debugMode = !this.debugMode;
                        document.getElementById('debug-info').style.display = this.debugMode ? 'block' : 'none';
                        console.log('ğŸ”§ Debugæ¨¡å¼:', this.debugMode ? 'é–‹å•Ÿ' : 'é—œé–‰');
                    }
                });
            }
            
            async loadCardData() {
                try {
                    this.showLoading();
                    
                    if (this.shareData) {
                        // å¾shareDataè¼‰å…¥
                        await this.loadFromShareData();
                    } else if (this.cardId && this.userId) {
                        // å¾APIè¼‰å…¥
                        await this.loadFromAPI();
                    } else {
                        // ä½¿ç”¨é è¨­è³‡æ–™
                        this.useDefaultData();
                    }
                    
                    this.updateOGMetaTags();
                    this.hideLoading();
                    this.showCardPreview();
                    
                } catch (error) {
                    console.error('âŒ è¼‰å…¥å¡ç‰‡è³‡æ–™å¤±æ•—:', error);
                    this.showError('è¼‰å…¥å¡ç‰‡è³‡æ–™å¤±æ•—: ' + error.message);
                }
            }
            
            async loadFromShareData() {
                console.log('ğŸ“¥ å¾shareDataè¼‰å…¥å¡ç‰‡è³‡æ–™');
                
                try {
                    const decodedData = atob(this.shareData);
                    this.cardData = JSON.parse(decodedData);
                    console.log('âœ… æˆåŠŸè§£æshareData:', this.cardData);
                } catch (error) {
                    throw new Error('shareDataè§£æå¤±æ•—: ' + error.message);
                }
            }
            
            async loadFromAPI() {
                console.log('ğŸ“¥ å¾APIè¼‰å…¥å¡ç‰‡è³‡æ–™');
                
                const response = await fetch(`/api/cards?pageId=${this.pageId}&userId=${this.userId}`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    this.cardData = result.data;
                    console.log('âœ… æˆåŠŸå¾APIè¼‰å…¥:', this.cardData);
                } else {
                    throw new Error('APIè¼‰å…¥å¤±æ•—: ' + (result.error || 'æœªçŸ¥éŒ¯èª¤'));
                }
            }
            
            useDefaultData() {
                console.log('ğŸ“‹ ä½¿ç”¨é è¨­å¡ç‰‡è³‡æ–™');
                this.cardData = {
                    main_title_1: 'æ­¡è¿ä¾†åˆ°å‘ˆç’½å…ƒå®‡å®™',
                    main_title_2: '3Då±•è¦½é¤¨',
                    display_name: 'å‘ˆç’½æœƒå“¡',
                    amember_id: 'å‘ˆç’½',
                    main_image_url: 'https://barv3.vercel.app/uploads/vip/TS-LOGO.png',
                    member_image_url: 'https://barv3.vercel.app/uploads/vip/TS-LOGO.png'
                };
            }
            
            updateOGMetaTags() {
                if (!this.cardData) return;
                
                const title = this.cardData.main_title_1 || 'å°ˆå±¬æœƒå“¡å¡';
                const description = this.cardData.main_title_2 || 'å‘ˆç’½å…ƒå®‡å®™3Då±•è¦½é¤¨';
                const image = this.cardData.main_image_url || 'https://barv3.vercel.app/uploads/vip/TS-LOGO.png';
                const url = window.location.href;
                
                // æ›´æ–°OG Meta Tags
                document.getElementById('og-title').setAttribute('content', title);
                document.getElementById('og-description').setAttribute('content', description);
                document.getElementById('og-image').setAttribute('content', image);
                document.getElementById('og-url').setAttribute('content', url);
                
                // æ›´æ–°Twitter Card
                document.getElementById('twitter-title').setAttribute('content', title);
                document.getElementById('twitter-description').setAttribute('content', description);
                document.getElementById('twitter-image').setAttribute('content', image);
                
                // æ›´æ–°é é¢æ¨™é¡Œ
                document.title = title + ' - å‘ˆç’½å…ƒå®‡å®™';
                
                console.log('âœ… OG Meta Tagså·²æ›´æ–°:', { title, description, image, url });
            }
            
            showCardPreview() {
                if (!this.cardData) return;
                
                // æ›´æ–°å¡ç‰‡åœ–ç‰‡
                const cardImage = document.getElementById('card-image');
                if (this.cardData.main_image_url) {
                    cardImage.src = this.cardData.main_image_url;
                }
                
                // æ›´æ–°å¡ç‰‡æ¨™é¡Œ
                const cardTitle = document.getElementById('card-title');
                cardTitle.textContent = this.cardData.main_title_1 || 'æ­¡è¿ä¾†åˆ°å‘ˆç’½å…ƒå®‡å®™';
                
                // æ›´æ–°å¡ç‰‡æè¿°
                const cardDescription = document.getElementById('card-description');
                cardDescription.textContent = this.cardData.main_title_2 || 'é«”é©—ç¨ç‰¹çš„3Då±•è¦½é¤¨æœƒå“¡å¡åˆ†äº«åŠŸèƒ½';
                
                // æ›´æ–°æœƒå“¡è³‡è¨Š
                const memberName = document.getElementById('member-name');
                memberName.textContent = this.cardData.display_name || 'å‘ˆç’½æœƒå“¡';
                
                const memberId = document.getElementById('member-id');
                memberId.textContent = 'æœƒå“¡ç·¨è™Ÿ: ' + (this.cardData.amember_id || 'å‘ˆç’½');
                
                console.log('âœ… å¡ç‰‡é è¦½å·²æ›´æ–°');
            }
            
            showLoading() {
                document.getElementById('card-preview').style.display = 'none';
                document.getElementById('loading').style.display = 'block';
                document.getElementById('error').style.display = 'none';
            }
            
            hideLoading() {
                document.getElementById('loading').style.display = 'none';
            }
            
            showCardPreview() {
                document.getElementById('card-preview').style.display = 'block';
            }
            
            showError(message) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('card-preview').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error-message').textContent = message;
            }
            
            updateDebugInfo() {
                if (!this.debugMode) return;
                
                const debugContent = document.getElementById('debug-content');
                debugContent.innerHTML = `
                    shareData: ${!!this.shareData}<br>
                    cardId: ${this.cardId || 'ç„¡'}<br>
                    userId: ${this.userId || 'ç„¡'}<br>
                    pageId: ${this.pageId}<br>
                    cardData: ${this.cardData ? 'å·²è¼‰å…¥' : 'ç„¡'}<br>
                    æ™‚é–“: ${new Date().toLocaleTimeString()}
                `;
            }
        }
        
        // åˆ†äº«åŠŸèƒ½
        function shareToLine() {
            const shareUrl = `https://liff.line.me/2007327814-OoJBbnwP?pageId=${ogManager.pageId}${ogManager.userId ? '&userId=' + ogManager.userId : ''}`;
            window.open(shareUrl, '_blank');
        }
        
        function shareToEmail() {
            const subject = encodeURIComponent('ğŸ¯ å‘ˆç’½å…ƒå®‡å®™æœƒå“¡å¡åˆ†äº«');
            const body = encodeURIComponent(`æ­¡è¿ä¾†åˆ°å‘ˆç’½å…ƒå®‡å®™3Då±•è¦½é¤¨ï¼\n\næŸ¥çœ‹æˆ‘çš„å°ˆå±¬æœƒå“¡å¡ï¼š\n${window.location.href}`);
            window.open(`mailto:?subject=${subject}&body=${body}`);
        }
        
        function shareToFacebook() {
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }
        
        // åˆå§‹åŒ–
        const ogManager = new OGPreviewManager();
        
        // å®šæœŸæ›´æ–°èª¿è©¦è³‡è¨Š
        setInterval(() => {
            ogManager.updateDebugInfo();
        }, 1000);
        
        console.log('ğŸš€ OGé è¦½é é¢å·²è¼‰å…¥');
    </script>
</body>
</html> 